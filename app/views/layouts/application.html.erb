<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <title><%= content_for(:title) || "NailMyJob" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f9f8f4">
    
    <link rel="manifest" href="<%= pwa_manifest_path %>">
    <link rel="icon" href="/favicon.ico" sizes="48x48">
    <link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="icon" href="/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/nailmyjob-logo.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="NailMyJob">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%# Fonts - System stack + DM Sans for wordmark %>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@700&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/service-worker");
      }
    </script>
    
    <style>
      :root {
        /* Basecamp-inspired warm palette */
        --color-page-bg: #f9f8f4; /* Warm paper */
        --color-card-bg: #ffffff;
        --color-text-main: #222222;
        --color-text-muted: #666666;
        
        /* Accents */
        --color-primary: #2d8a6e; /* Softer, deep emerald */
        --color-primary-dark: #1f6b54;
        --color-border: #e6e4dc;
        --color-input-border: #dcdad1;
        
        /* Typography - System Fonts for maximum clarity */
        --font-serif: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      }
      
      html { 
        font-size: 18px; /* Bigger base size like Basecamp */
        -webkit-font-smoothing: antialiased;
      }
      
      body {
        font-family: var(--font-sans);
        background-color: var(--color-page-bg);
        color: var(--color-text-main);
        line-height: 1.6;
      }
      
      h1, h2, h3, h4, .font-serif {
        font-family: var(--font-serif);
        font-weight: 900;
        letter-spacing: -0.02em;
        color: #1a1a1a;
      }
      
      /* Human Buttons */
      .btn-primary {
        background-color: var(--color-primary);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 9999px; /* Pill shape */
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.2s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        text-align: center;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
      
      .btn-primary:hover {
        background-color: var(--color-primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.12);
      }

      .btn-secondary {
        background-color: white;
        color: var(--color-text-main);
        border: 1px solid var(--color-border);
        padding: 0.75rem 1.5rem;
        border-radius: 9999px;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.15s;
        text-align: center;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .btn-secondary:hover {
        background-color: #fbfbfb;
        border-color: #ccc;
      }
      
      /* Cards */
      .card {
        background-color: var(--color-card-bg);
        border-radius: 1rem; /* Big rounded corners */
        box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        border: 1px solid rgba(0,0,0,0.04);
      }
      
      /* Inputs - Big and clear */
      input[type="text"],
      input[type="email"],
      input[type="tel"],
      input[type="number"],
      input[type="password"],
      input[type="date"],
      textarea,
      select {
        background-color: #ffffff;
        border: 2px solid var(--color-input-border);
        border-radius: 0.75rem;
        padding: 0.875rem 1rem; /* Large padding */
        font-size: 1.1rem;
        width: 100%;
        color: var(--color-text-main);
        transition: border-color 0.2s, box-shadow 0.2s;
        font-family: var(--font-sans);
      }
      
      input::placeholder, textarea::placeholder {
        color: #999;
      }
      
      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 4px rgba(45, 138, 110, 0.1);
      }

      label {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
        display: block;
        font-size: 0.95rem;
      }
    </style>
  </head>

  <body class="min-h-full flex flex-col">
    <% if user_signed_in? %>
      <%# Navigation - Simple, centered %>
      <header class="pt-6 pb-2 px-4 sm:px-6">
        <div class="max-w-5xl mx-auto">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-8">
              <%= link_to dashboard_path, class: "group" do %>
                <span style="font-family: 'DM Sans', sans-serif; font-weight: 700; font-size: 1.4rem; color: #1a1a1a; letter-spacing: -0.02em;"><%= current_company&.name.presence || "nailmyjob" %></span>
              <% end %>

              <nav class="hidden sm:flex items-center gap-1 bg-white p-1 rounded-full border border-stone-200 shadow-sm">
                <%= link_to "Quotes", quotes_path, class: "px-4 py-1.5 rounded-full text-sm font-semibold transition-colors #{current_page?(quotes_path) ? 'bg-[#2d8a6e] text-white shadow-sm' : 'text-stone-600 hover:bg-stone-100 hover:text-stone-900'}" %>
                <%= link_to "Jobs", jobs_path, class: "px-4 py-1.5 rounded-full text-sm font-semibold transition-colors #{current_page?(jobs_path) ? 'bg-[#2d8a6e] text-white shadow-sm' : 'text-stone-600 hover:bg-stone-100 hover:text-stone-900'}" %>
                <%= link_to "Clients", clients_path, class: "px-4 py-1.5 rounded-full text-sm font-semibold transition-colors #{current_page?(clients_path) ? 'bg-[#2d8a6e] text-white shadow-sm' : 'text-stone-600 hover:bg-stone-100 hover:text-stone-900'}" %>
              </nav>
            </div>

            <div class="flex items-center gap-3">
              <%= link_to new_quote_path, class: "hidden sm:inline-flex btn-primary !py-2 !px-4 !text-sm" do %>
                <span>+</span> New Quote
              <% end %>
              
              <div class="relative" data-controller="dropdown">
                <button type="button" 
                        class="w-10 h-10 rounded-full bg-white border border-stone-200 flex items-center justify-center text-stone-600 hover:border-stone-300 transition-colors"
                        data-action="click->dropdown#toggle">
                  <%= current_user.initials %>
                </button>
                
                <div class="hidden absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-black/5 py-2 z-50 overflow-hidden"
                     data-dropdown-target="menu">
                  <div class="px-4 py-3 bg-stone-50 border-b border-stone-100">
                    <p class="font-bold text-stone-900"><%= current_user.full_name %></p>
                    <p class="text-xs text-stone-500"><%= current_company&.name %></p>
                  </div>
                  <%= link_to edit_company_path, class: "block px-4 py-2.5 text-stone-700 hover:bg-emerald-50 hover:text-emerald-800 transition-colors font-medium" do %>
                    Company Settings
                  <% end %>
                  <%= button_to destroy_user_session_path, method: :delete, class: "w-full text-left px-4 py-2.5 text-red-600 hover:bg-red-50 transition-colors font-medium", data: { turbo: false } do %>
                    Sign out
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
    <% end %>

    <%# Flash Messages %>
    <% if flash.any? %>
      <div class="fixed top-6 left-1/2 -translate-x-1/2 z-50 w-full max-w-sm px-4">
        <% flash.each do |type, message| %>
          <div class="rounded-xl px-5 py-4 shadow-xl border <%= type == 'alert' || type == 'error' ? 'bg-white border-red-100 text-red-800' : 'bg-white border-emerald-100 text-emerald-800' %> flex items-center gap-3"
               data-controller="flash"
               data-flash-target="notification"
               data-action="animationend->flash#remove">
             <% if type == 'notice' || type == 'success' %>
               <svg class="w-6 h-6 text-emerald-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
             <% else %>
               <svg class="w-6 h-6 text-red-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
             <% end %>
            <p class="font-medium"><%= message %></p>
          </div>
        <% end %>
      </div>
    <% end %>

    <%# Main Content %>
    <main class="flex-1 w-full max-w-5xl mx-auto px-4 sm:px-6 py-8">
      <%= yield %>
    </main>

    <% if user_signed_in? %>
      <%# Mobile Nav %>
      <nav class="sm:hidden fixed bottom-0 inset-x-0 bg-white/90 backdrop-blur-lg border-t border-stone-200 z-40 pb-safe">
        <div class="flex justify-around items-center h-16">
          <%= link_to dashboard_path, class: "flex flex-col items-center gap-0.5 p-2 rounded-xl transition-colors #{current_page?(dashboard_path) ? 'text-emerald-700' : 'text-stone-400'}" do %>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            <span class="text-[10px] font-bold uppercase tracking-wide">Home</span>
          <% end %>
          
          <%= link_to quotes_path, class: "flex flex-col items-center gap-0.5 p-2 rounded-xl transition-colors #{current_page?(quotes_path) ? 'text-emerald-700' : 'text-stone-400'}" do %>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            <span class="text-[10px] font-bold uppercase tracking-wide">Quotes</span>
          <% end %>

          <%= link_to new_quote_path, class: "flex flex-col items-center justify-center w-12 h-12 rounded-full bg-emerald-600 text-white shadow-lg -mt-8 border-4 border-white" do %>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
          <% end %>
          
          <%= link_to jobs_path, class: "flex flex-col items-center gap-0.5 p-2 rounded-xl transition-colors #{current_page?(jobs_path) ? 'text-emerald-700' : 'text-stone-400'}" do %>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
            <span class="text-[10px] font-bold uppercase tracking-wide">Jobs</span>
          <% end %>
          
          <%= link_to edit_company_path, class: "flex flex-col items-center gap-0.5 p-2 rounded-xl transition-colors #{current_page?(edit_company_path) ? 'text-emerald-700' : 'text-stone-400'}" do %>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            <span class="text-[10px] font-bold uppercase tracking-wide">Settings</span>
          <% end %>
        </div>
      </nav>
      <div class="h-20 sm:hidden"></div>
    <% end %>
  </body>
</html>
